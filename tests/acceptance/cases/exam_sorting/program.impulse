module exam::sorting;

// Task 2: Array Sorting (Sorting Algorithm)
// Objective: Implement an algorithm to sort an array (quicksort).
// Purpose: Test array handling, loop operations, and element comparison.
// Benchmark: Measure the time taken to sort an array of 10,000 elements.

func swap(arr: array, i: int, j: int) -> int {
    let temp: int = array_get(arr, i);
    array_set(arr, i, array_get(arr, j));
    array_set(arr, j, temp);
    return 0;
}

func partition(arr: array, low: int, high: int) -> int {
    let pivot: int = array_get(arr, high);
    let i: int = low - 1;
    let j: int = low;
    
    while j < high {
        if array_get(arr, j) <= pivot {
            let i: int = i + 1;
            swap(arr, i, j);
        }
        let j: int = j + 1;
    }
    
    let i: int = i + 1;
    swap(arr, i, high);
    return i;
}

func quicksort(arr: array, low: int, high: int) -> int {
    if low < high {
        let pi: int = partition(arr, low, high);
        quicksort(arr, low, pi - 1);
        quicksort(arr, pi + 1, high);
    }
    return 0;
}

func is_sorted(arr: array) -> int {
    let n: int = array_length(arr);
    let i: int = 0;
    while i < n - 1 {
        if array_get(arr, i) > array_get(arr, i + 1) {
            return 0;
        }
        let i: int = i + 1;
    }
    return 1;
}

func main() -> int {
    // Create test array with 20 elements (smaller for acceptance test)
    let arr: array = array(20);
    
    // Fill with descending values (worst case for quicksort)
    let i: int = 0;
    while i < 20 {
        array_set(arr, i, 20 - i);
        let i: int = i + 1;
    }
    
    println("Before sorting:");
    println(array_join(arr, ", "));
    
    // Sort the array
    quicksort(arr, 0, 19);
    
    println("After sorting:");
    println(array_join(arr, ", "));
    
    // Verify sorted
    let sorted: int = is_sorted(arr);
    if sorted == 1 {
        println("Array is correctly sorted!");
    } else {
        println("ERROR: Array is not sorted!");
    }
    
    return sorted;
}
